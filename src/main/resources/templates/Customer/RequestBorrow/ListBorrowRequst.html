<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head th:replace="Customer/fragments/header :: html_head">
</head>

<body>

<!-- Start: Header Section -->
<header id="header-v1" class="navbar-wrapper inner-navbar-wrapper">
    <div class="container">
        <div class="row">
            <nav class="navbar navbar-default">
                <div class="row">
                    <div class="col-md-3">
                        <div class="navbar-header">
                            <div class="navbar-brand">
                                <h1>
                                    <a href="index-2.html">
                                        <img src="images/libraria-logo-v1.png" alt="LIBRARIA"/>
                                    </a>
                                </h1>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-9">
                        <!-- Header Topbar -->
                        <div class="header-topbar hidden-sm hidden-xs">
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="topbar-info">
                                        <a href="tel:+61-3-8376-6284"><i class="fa fa-phone"></i>+61-3-8376-6284</a>
                                        <span>/</span>
                                        <a href="mailto:support@libraria.com"><i class="fa fa-envelope"></i>support@libraria.com</a>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="topbar-links">
                                        <a href="signin.html"><i class="fa fa-lock"></i>Login / Register</a>
                                        <span>|</span>
                                        <div class="header-cart dropdown">
                                            <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                                                <i class="fa fa-shopping-cart"></i>
                                                <small>0</small>
                                            </a>
                                            <div class="dropdown-menu cart-dropdown">
                                                <ul>
                                                    <li class="clearfix">
                                                        <img src="images/header-cart-image-01.jpg" alt="cart item"/>
                                                        <div class="item-info">
                                                            <div class="name">
                                                                <a href="#">The Great Gatsby</a>
                                                            </div>
                                                            <div class="author"><strong>Author:</strong> F. Scott
                                                                Fitzgerald
                                                            </div>
                                                            <div class="price">1 X $10.00</div>
                                                        </div>
                                                        <a class="remove" href="#"><i class="fa fa-trash-o"></i></a>
                                                    </li>
                                                    <li class="clearfix">
                                                        <img src="images/header-cart-image-02.jpg" alt="cart item"/>
                                                        <div class="item-info">
                                                            <div class="name">
                                                                <a href="#">The Great Gatsby</a>
                                                            </div>
                                                            <div class="author"><strong>Author:</strong> F. Scott
                                                                Fitzgerald
                                                            </div>
                                                            <div class="price">1 X $10.00</div>
                                                        </div>
                                                        <a class="remove" href="#"><i class="fa fa-trash-o"></i></a>
                                                    </li>
                                                    <li class="clearfix">
                                                        <img src="images/header-cart-image-03.jpg" alt="cart item"/>
                                                        <div class="item-info">
                                                            <div class="name">
                                                                <a href="#">The Great Gatsby</a>
                                                            </div>
                                                            <div class="author"><strong>Author:</strong> F. Scott
                                                                Fitzgerald
                                                            </div>
                                                            <div class="price">1 X $10.00</div>
                                                        </div>
                                                        <a class="remove" href="#"><i class="fa fa-trash-o"></i></a>
                                                    </li>
                                                </ul>
                                                <div class="cart-total">
                                                    <div class="title">SubTotal</div>
                                                    <div class="price">$30.00</div>
                                                </div>
                                                <div class="cart-buttons">
                                                    <a href="cart.html" class="btn btn-dark-gray">View Cart</a>
                                                    <a href="checkout.html" class="btn btn-primary">Checkout</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="navbar-collapse hidden-sm hidden-xs">
                            <ul class="nav navbar-nav">
                                <li class="dropdown active">
                                    <a data-toggle="dropdown" class="dropdown-toggle disabled"
                                       href="index-2.html">Home</a>
                                    <ul class="dropdown-menu">
                                        <li><a href="index-2.html">Home V1</a></li>
                                        <li><a href="home-v2.html">Home V2</a></li>
                                        <li><a href="home-v3.html">Home V3</a></li>
                                    </ul>
                                </li>
                                <li class="dropdown">
                                    <a data-toggle="dropdown" class="dropdown-toggle disabled"
                                       href="books-media-list-view.html">Books &amp; Media</a>
                                    <ul class="dropdown-menu">
                                        <li><a href="books-media-list-view.html">Books &amp; Media List View</a></li>
                                        <li><a href="books-media-gird-view-v1.html">Books &amp; Media Grid View V1</a>
                                        </li>
                                        <li><a href="books-media-gird-view-v2.html">Books &amp; Media Grid View V2</a>
                                        </li>
                                        <li><a href="books-media-detail-v1.html">Books &amp; Media Detail V1</a></li>
                                        <li><a href="books-media-detail-v2.html">Books &amp; Media Detail V2</a></li>
                                    </ul>
                                </li>
                                <li class="dropdown">
                                    <a data-toggle="dropdown" class="dropdown-toggle disabled"
                                       href="news-events-list-view.html">News &amp; Events</a>
                                    <ul class="dropdown-menu">
                                        <li><a href="news-events-list-view.html">News &amp; Events List View</a></li>
                                        <li><a href="news-events-detail.html">News &amp; Events Detail</a></li>
                                    </ul>
                                </li>
                                <li class="dropdown">
                                    <a data-toggle="dropdown" class="dropdown-toggle disabled" href="#">Pages</a>
                                    <ul class="dropdown-menu">
                                        <li><a href="cart.html">Cart</a></li>
                                        <li><a href="checkout.html">Checkout</a></li>
                                        <li><a href="signin.html">Signin/Register</a></li>
                                        <li><a href="404.html">404/Error</a></li>
                                    </ul>
                                </li>
                                <li class="dropdown">
                                    <a data-toggle="dropdown" class="dropdown-toggle disabled" href="blog.html">Blog</a>
                                    <ul class="dropdown-menu">
                                        <li><a href="blog.html">Blog Grid View</a></li>
                                        <li><a href="blog-detail.html">Blog Detail</a></li>
                                    </ul>
                                </li>
                                <li><a href="services.html">Services</a></li>
                                <li><a href="contact.html">Contact</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="mobile-menu hidden-lg hidden-md">
                    <a href="#mobile-menu"><i class="fa fa-navicon"></i></a>
                    <div id="mobile-menu">
                        <ul>
                            <li class="mobile-title">
                                <h4>Navigation</h4>
                                <a href="#" class="close"></a>
                            </li>
                            <li>
                                <a href="index-2.html">Home</a>
                                <ul>
                                    <li><a href="index-2.html">Home V1</a></li>
                                    <li><a href="home-v2.html">Home V2</a></li>
                                    <li><a href="home-v3.html">Home V3</a></li>
                                </ul>
                            </li>
                            <li>
                                <a href="books-media-list-view.html">Books &amp; Media</a>
                                <ul>
                                    <li><a href="books-media-list-view.html">Books &amp; Media List View</a></li>
                                    <li><a href="books-media-gird-view-v1.html">Books &amp; Media Grid View V1</a></li>
                                    <li><a href="books-media-gird-view-v2.html">Books &amp; Media Grid View V2</a></li>
                                    <li><a href="books-media-detail-v1.html">Books &amp; Media Detail V1</a></li>
                                    <li><a href="books-media-detail-v2.html">Books &amp; Media Detail V2</a></li>
                                </ul>
                            </li>
                            <li>
                                <a href="news-events-list-view.html">News &amp; Events</a>
                                <ul>
                                    <li><a href="news-events-list-view.html">News &amp; Events List View</a></li>
                                    <li><a href="news-events-detail.html">News &amp; Events Detail</a></li>
                                </ul>
                            </li>
                            <li>
                                <a href="#">Pages</a>
                                <ul>
                                    <li><a href="cart.html">Cart</a></li>
                                    <li><a href="checkout.html">Checkout</a></li>
                                    <li><a href="signin.html">Signin/Register</a></li>
                                    <li><a href="404.html">404/Error</a></li>
                                </ul>
                            </li>
                            <li>
                                <a href="blog.html">Blog</a>
                                <ul>
                                    <li><a href="blog.html">Blog Grid View</a></li>
                                    <li><a href="blog-detail.html">Blog Detail</a></li>
                                </ul>
                            </li>
                            <li><a href="services.html">Services</a></li>
                            <li><a href="contact.html">Contact</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    </div>
</header>
<!-- End: Header Section -->

<!-- Start: Page Banner -->
<section class="page-banner services-banner">
    <div class="container">
        <div class="banner-header">
            <h2>Signin</h2>
            <span class="underline center"></span>
            <p class="lead">Proin ac eros pellentesque dolor pharetra tempo.</p>
        </div>
        <div class="breadcrumb">
            <ul>
                <li><a href="index-2.html">Home</a></li>
                <li>Signin</li>
            </ul>
        </div>
    </div>
</section>
<!-- End: Page Banner -->
<!-- Start: Cart Section -->
<div id="content" class="site-content">
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addBorrowRequest">Create Borrow Request
    </button>
    <table class="table">
        <thead>
        <tr>
            <th>ID</th>
            <th>Borrow Date</th>
            <th>Return Date</th>
            <th>Book Name</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        <th:block th:each="item : ${list}">
            <tr>
                <td th:text="${item.id}"></td>
                <td th:text="${#dates.format(item.borrow_date, 'dd-MM-yyyy')}"></td>
                <td th:text="${#dates.format(item.return_date, 'dd-MM-yyyy')}"></td>
                <td th:text="${item.book_item != null && item.book_item.book != null ? item.book_item.book.name : 'N/A'}"></td>
                <td th:text="${item.status.name()}"></td>
                <td>
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                            th:attr="data-bs-target='#editBorrowRequest' + ${item.id}"
                            data-bs-whatever="@fat">Edit Borrow Request
                    </button>
                </td>
                <div class="modal" th:attr="id='editBorrowRequest' + ${item.id}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Edit Borrow Request</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form th:action="@{/customer/borrow/{id}(id=${item.id})}" method="post" id="editForm">
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <label for="bdateEdit" class="col-form-label">Borrow Date</label>
                                        <input type="date" class="form-control" id="bdateEdit" name="bdate" th:value="${#dates.format(item.borrow_date, 'yyyy-MM-dd')}" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="rdateEdit" class="col-form-label">Return Date</label>
                                        <input type="date" class="form-control" id="rdateEdit" name="rdate" th:value="${#dates.format(item.return_date, 'yyyy-MM-dd')}" required>
                                    </div>
                                    <th:block th:each="i:${books}">
                                        <div class="form-check">
                                            <input class="form-check-input" th:value="${i.id}" type="radio" name="bookID"
                                                   th:attr="id='book' + ${item.id}" th:checked="${item.book_item != null && item.book_item.book != null && item.book_item.book.id == i.id}" required>
                                            <label class="form-check-label" th:text="${i.name}">
                                            </label>
                                        </div>
                                    </th:block>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Update</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </tr>
        </th:block>
        </tbody>
    </table>
    <div class="pagination" th:if="${!list.getContent().isEmpty()}">
        <a th:if="${list.pageable.pageNumber > 0}"
           th:href="@{/customer/borrow(page=${list.pageable.pageNumber - 1})}"
           class="pagination-page">Previous</a>

        <a th:each="i : ${#numbers.sequence(0, list.totalPages - 1)}"
           th:href="@{/customer/borrow(page=${i})}"
           th:text="${i + 1}"
           th:classappend="${i == list.pageable.pageNumber} ? 'active' : ''">
        </a>

        <a th:if="${list.pageable.pageNumber < list.totalPages - 1}"
           th:href="@{/customer/borrow(page=${list.pageable.pageNumber + 1})}"
           class="pagination-page">Next</a>
    </div>
    <div class="modal" id="addBorrowRequest" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" >Create Borrow Request</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form th:action="@{/customer/borrow}" method="post" id="dateForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="bdate" class="col-form-label">Borrow Date</label>
                            <input type="date" class="form-control" id="bdate" name="bdate" required>
                        </div>
                        <div class="mb-3">
                            <label for="rdate" class="col-form-label">Return Date</label>
                            <input type="date" class="form-control" id="rdate" name="rdate" required>
                        </div>
                        <th:block th:each="item:${books}">
                            <div class="form-check">
                                <input class="form-check-input" th:value="${item.id}" type="radio" name="bookID"
                                       th:attr="id='book${item.id}'" required>
                                <label class="form-check-label" th:text="${item.name}">
                                </label>
                            </div>
                        </th:block>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Create</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- End: Cart Section -->

<!-- Start: Social Network -->
<section class="social-network section-padding">
    <div class="container">
        <div class="center-content">
            <h2 class="section-title">Follow Us</h2>
            <span class="underline center"></span>
            <p class="lead">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
        </div>
        <ul>
            <li>
                <a class="facebook" href="#" target="_blank">
                            <span>
                                <i class="fa fa-facebook-f"></i>
                            </span>
                </a>
            </li>
            <li>
                <a class="twitter" href="#" target="_blank">
                            <span>
                                <i class="fa fa-twitter"></i>
                            </span>
                </a>
            </li>
            <li>
                <a class="google" href="#" target="_blank">
                            <span>
                                <i class="fa fa-google-plus"></i>
                            </span>
                </a>
            </li>
            <li>
                <a class="rss" href="#" target="_blank">
                            <span>
                                <i class="fa fa-rss"></i>
                            </span>
                </a>
            </li>
            <li>
                <a class="linkedin" href="#" target="_blank">
                            <span>
                                <i class="fa fa-linkedin"></i>
                            </span>
                </a>
            </li>
            <li>
                <a class="youtube" href="#" target="_blank">
                            <span>
                                <i class="fa fa-youtube"></i>
                            </span>
                </a>
            </li>
        </ul>
    </div>
</section>
<!-- End: Social Network -->

<!-- Start: Footer -->
<footer th:replace="Customer/fragments/footer :: html_foot">

</footer>
<!-- End: Footer -->

<!-- jQuery Latest Version 1.x -->
<script type="text/javascript" src="js/jquery-1.12.4.min.js"></script>

<!-- jQuery UI -->
<script type="text/javascript" src="js/jquery-ui.min.js"></script>

<!-- jQuery Easing -->
<script type="text/javascript" src="js/jquery.easing.1.3.js"></script>

<!-- Bootstrap -->
<script type="text/javascript" src="js/bootstrap.min.js"></script>

<!-- Mobile Menu -->
<script type="text/javascript" src="js/mmenu.min.js"></script>

<!-- Harvey - State manager for media queries -->
<script type="text/javascript" src="js/harvey.min.js"></script>

<!-- Waypoints - Load Elements on View -->
<script type="text/javascript" src="js/waypoints.min.js"></script>

<!-- Facts Counter -->
<script type="text/javascript" src="js/facts.counter.min.js"></script>

<!-- MixItUp - Category Filter -->
<script type="text/javascript" src="js/mixitup.min.js"></script>

<!-- Owl Carousel -->
<script type="text/javascript" src="js/owl.carousel.min.js"></script>

<!-- Accordion -->
<script type="text/javascript" src="js/accordion.min.js"></script>

<!-- Responsive Tabs -->
<script type="text/javascript" src="js/responsive.tabs.min.js"></script>

<!-- Responsive Table -->
<script type="text/javascript" src="js/responsive.table.min.js"></script>

<!-- Masonry -->
<script type="text/javascript" src="js/masonry.min.js"></script>

<!-- Carousel Swipe -->
<script type="text/javascript" src="js/carousel.swipe.min.js"></script>

<!-- bxSlider -->
<script type="text/javascript" src="js/bxslider.min.js"></script>

<!-- Custom Scripts -->
<script type="text/javascript" src="js/main.js"></script>
<script type="text/javascript">
    document.getElementById("dateForm").addEventListener("submit", function (event) {
        // Lấy giá trị ngày từ các ô input
        const startDate = new Date(document.getElementById("bdate").value);
        const endDate = new Date(document.getElementById("rdate").value);

        // Kiểm tra nếu endDate <= startDate
        if (endDate <= startDate) {
            // Ngăn form gửi đi
            event.preventDefault();

            // Hiển thị thông báo lỗi bằng Toastify
            Toastify({
                text: "Return Date không được nhỏ hơn hoặc bằng Borrow Date!",
                duration: 3000, // Thời gian hiển thị (ms)
                close: true,    // Hiển thị nút đóng
                gravity: "top", // Vị trí xuất hiện (top/bottom)
                position: "right", // Vị trí bên phải/trái (left/right)
                backgroundColor: "linear-gradient(to right, #ff5f6d, #ffc371)", // Màu nền
            }).showToast();
        }
    });

    document.getElementById("editForm").addEventListener("submit", function (event) {
        // Lấy giá trị ngày từ các ô input
        const startDate = new Date(document.getElementById("bdateEdit").value);
        const endDate = new Date(document.getElementById("rdateEdit").value);

        // Kiểm tra nếu endDate <= startDate
        if (endDate <= startDate) {
            // Ngăn form gửi đi
            event.preventDefault();

            // Hiển thị thông báo lỗi bằng Toastify
            Toastify({
                text: "Return Date không được nhỏ hơn hoặc bằng Borrow Date!",
                duration: 3000, // Thời gian hiển thị (ms)
                close: true,    // Hiển thị nút đóng
                gravity: "top", // Vị trí xuất hiện (top/bottom)
                position: "right", // Vị trí bên phải/trái (left/right)
                backgroundColor: "linear-gradient(to right, #ff5f6d, #ffc371)", // Màu nền
            }).showToast();
        }
    });
</script>
</body>

</html>
